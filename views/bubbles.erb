<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>BUBBLES!</title>
</head>
<body>
  <div class="wrapper"></div>

  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="bubbles.js"></script>
  <script>
    function setupStream(stream_uri) {
      var json, type, color;

      stream = new EventSource(stream_uri)

      stream.onmessage = function(event) {
        json = JSON.parse(event.data);

        type  = json.type || 'none';
        color = json.color;

        new Bubble().init(type, color);
      }
    }

    <% "/stream|#{ENV['STREAMS']}".split('|').each do |stream| %>
      setupStream("<%= stream %>");
    <% end %>

    <%= erb :flow_dock %>
    <%= erb :cctv %>
  </script>
</body>
</html>
